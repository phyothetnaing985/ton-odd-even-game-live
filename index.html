<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0">
    <title>GOLDEN HUB - TACT v3.2 OFFICIAL</title>
    <script src="https://unpkg.com/@tonconnect/ui@latest/dist/tonconnect-ui.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/tonweb@0.0.66/dist/tonweb.js"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <style>
        :root { --bg: #0b0e11; --card: #161b22; --accent: #f3ba2f; --green: #00c087; --text: #eaecef; --nav: #161b22; --btn: #2b3139; }
        .light-mode { --bg: #f5f5f5; --card: #ffffff; --accent: #0088cc; --green: #2ecc71; --text: #1e2329; --nav: #ffffff; --btn: #e4e6eb; }
        body { margin: 0; background: var(--bg); color: var(--text); font-family: 'Inter', sans-serif; transition: 0.3s; padding-bottom: 85px; overflow-x: hidden; }
        .header { display: flex; justify-content: space-between; padding: 15px; background: var(--card); align-items: center; position: sticky; top:0; z-index:100; border-bottom: 1px solid rgba(255,255,255,0.05); }
        .screen { display: none; flex-direction: column; align-items: center; padding: 15px; animation: fadeIn 0.3s; width: 100%; box-sizing: border-box; }
        .active-screen { display: flex; }
        .game-card { width: 100%; max-width: 420px; background: var(--card); border-radius: 20px; padding: 20px; margin-bottom: 15px; border: 1px solid rgba(255,255,255,0.05); box-shadow: 0 4px 15px rgba(0,0,0,0.2); }
        .side-btn { flex: 1; padding: 18px; border-radius: 12px; border: 2px solid var(--btn); background: var(--btn); color: white; font-weight: 800; cursor: pointer; transition: 0.2s; }
        .side-btn.selected { border-color: var(--accent); background: rgba(243, 186, 47, 0.15); box-shadow: 0 0 10px rgba(243, 186, 47, 0.2); }
        .history-table { width: 100%; max-width: 420px; border-collapse: collapse; margin-top: 10px; font-size: 0.75rem; background: var(--card); border-radius: 12px; overflow: hidden; }
        .history-table th { background: rgba(255,255,255,0.03); color: var(--accent); padding: 12px; text-align: left; }
        .history-table td { padding: 12px; border-bottom: 1px solid rgba(255,255,255,0.03); }
        .footer { position: fixed; bottom: 0; width: 100%; height: 75px; background: var(--nav); display: flex; border-top: 1px solid rgba(255,255,255,0.05); z-index: 100; }
        .nav-item { flex: 1; display: flex; flex-direction: column; justify-content: center; align-items: center; color: #848e9c; cursor: pointer; font-size: 0.75rem; gap: 5px; }
        .nav-item.active { color: var(--accent); }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }
    </style>
</head>
<body>

<div class="header">
    <div id="ton-connect-btn"></div>
    <i class="fas fa-moon" id="theme-icon" onclick="toggleTheme()" style="font-size: 1.3rem; color: var(--accent); cursor: pointer;"></i>
</div>

<div id="lobby-screen" class="screen active-screen">
    <h2 style="align-self: flex-start; margin-left: 2%; color: var(--accent);">GOLDEN HUB</h2>
    <div class="game-card" style="display: flex; justify-content: space-between; align-items: center;">
        <div style="display: flex; align-items: center; gap: 15px;">
            <img src="https://i.postimg.cc/XJfvQK5S/IMG-20260115-210549.png" width="55" style="border-radius: 12px;">
            <div>
                <div style="font-weight: 900;">ODD EVEN</div>
                <div style="font-size: 0.65rem; color: var(--green); font-weight: bold;">v3.2 VERIFIED</div>
            </div>
        </div>
        <button onclick="showScreen('play-screen')" style="background: var(--accent); border: none; padding: 10px 20px; border-radius: 10px; font-weight: 900; color: #000; cursor: pointer;">PLAY</button>
    </div>
</div>

<div id="play-screen" class="screen">
    <div class="game-card">
        <div style="display: flex; justify-content: space-between; margin-bottom: 20px; font-weight: bold;">
            <div style="background: var(--btn); padding: 10px 15px; border-radius: 10px;">BET: <span id="bet-amt">0.10</span> TON</div>
            <div style="background: var(--btn); padding: 10px 15px; border-radius: 10px;">WIN: <span id="win-amt" style="color:var(--green)">0.19</span> TON</div>
        </div>
        <input type="range" min="0.1" max="1.0" step="0.1" value="0.1" style="width: 100%; accent-color: var(--accent);" oninput="updateBet(this.value)">
        <div style="display: flex; gap: 15px; margin: 25px 0;">
            <button id="btn-odd" class="side-btn" onclick="setSide(false)">ODD</button>
            <button id="btn-even" class="side-btn" onclick="setSide(true)">EVEN</button>
        </div>
        <button id="place-bet-btn" onclick="placeBet()" style="width: 100%; padding: 18px; border-radius: 12px; background: var(--green); border: none; color: white; font-weight: 900; font-size: 1.1rem; cursor: pointer;">PLACE BET NOW</button>
    </div>
    
    <h4 style="align-self: flex-start; margin-left: 5%; opacity: 0.8;"><i class="fas fa-history"></i> Live History</h4>
    <table class="history-table">
        <thead><tr><th>Player</th><th>Side</th><th>Status</th></tr></thead>
        <tbody id="history-body"></tbody>
    </table>
</div>

<div id="invite-screen" class="screen">
    <div class="game-card" style="text-align: center; border: 1px solid var(--accent);">
        <i class="fas fa-gift" style="font-size: 2.5rem; color: var(--accent); margin-bottom: 10px;"></i>
        <h3>10% Referral</h3>
        <div style="background: rgba(0,192,135,0.1); padding: 20px; border-radius: 15px; margin: 20px 0; border: 1px solid var(--green);">
            <div id="ref-bal" style="font-size: 1.8rem; font-weight: 900; color: var(--green);">0.00 TON</div>
            <button onclick="withdrawRef()" style="margin-top:12px; background:var(--green); border:none; color:white; padding:10px 20px; border-radius:8px; font-weight:bold; cursor:pointer; width:100%;">WITHDRAW REWARDS</button>
        </div>
        <div id="ref-link" style="font-size: 0.7rem; word-break: break-all; opacity: 0.6; margin-bottom: 10px; background: #000; padding: 10px; border-radius: 5px;">Connect wallet to see link</div>
        <button onclick="copyRef()" id="copy-btn" style="width: 100%; background: transparent; border: 2px solid var(--accent); color: var(--accent); padding: 12px; border-radius: 10px; font-weight: bold; cursor: pointer;">COPY LINK</button>
    </div>
</div>

<div class="footer">
    <div class="nav-item active" onclick="showScreen('lobby-screen')"><i class="fas fa-th-large"></i><span>Lobby</span></div>
    <div class="nav-item" onclick="showScreen('invite-screen')"><i class="fas fa-users"></i><span>Invite</span></div>
</div>

<script>
    const CONTRACT_ADDRESS = "EQD6Ec2ZgY1ehW8FULm_tosmXgSMDrUYFszQeyqunVGfgf26";
    let selectedSide = null;
    const tonWeb = new TonWeb();
    
    const tonConnectUI = new TON_CONNECT_UI.TonConnectUI({ 
        manifestUrl: "https://gist.githubusercontent.com/ton-blockchain/7f75S-manifest.json", 
        buttonRootId: 'ton-connect-btn' 
    });

    function showScreen(id) {
        document.querySelectorAll('.screen').forEach(s => s.classList.remove('active-screen'));
        document.getElementById(id).classList.add('active-screen');
        document.querySelectorAll('.nav-item').forEach(n => n.classList.toggle('active', id.includes(n.innerText.toLowerCase())));
    }

    function toggleTheme() {
        document.body.classList.toggle('light-mode');
        document.getElementById('theme-icon').classList.toggle('fa-sun');
    }

    function updateBet(v) {
        document.getElementById('bet-amt').innerText = parseFloat(v).toFixed(2);
        document.getElementById('win-amt').innerText = (v * 1.9).toFixed(2);
    }

    function setSide(s) {
        selectedSide = s;
        document.getElementById('btn-even').classList.toggle('selected', s === true);
        document.getElementById('btn-odd').classList.toggle('selected', s === false);
    }

    async function placeBet() {
        if (!tonConnectUI.connected) return alert("Please connect wallet first!");
        if (selectedSide === null) return alert("Select ODD or EVEN!");
        
        const betBtn = document.getElementById('place-bet-btn');
        betBtn.innerText = "WAITING FOR WALLET...";
        betBtn.disabled = true;

        try {
            const amount = TonWeb.utils.toNano(document.getElementById('bet-amt').innerText);
            const cell = new TonWeb.boc.Cell();
            
            // OpCode: 0x65228565 (Bet)
            cell.bits.writeUint(0x65228565, 32); 
            // side: Bool
            cell.bits.writeBit(selectedSide);
            
            // referrer: Address?
            const urlParams = new URLSearchParams(window.location.search);
            const refAddr = urlParams.get('ref');
            
            if (refAddr && TonWeb.utils.Address.isValid(refAddr)) {
                cell.bits.writeBit(true); // Maybe: Just
                cell.bits.writeAddress(new TonWeb.utils.Address(refAddr));
            } else {
                cell.bits.writeBit(false); // Maybe: Nothing
            }

            const payload = TonWeb.utils.bytesToBase64(await cell.toBoc());

            await tonConnectUI.sendTransaction({
                validUntil: Math.floor(Date.now() / 1000) + 300,
                messages: [{
                    address: CONTRACT_ADDRESS,
                    amount: amount.toString(),
                    payload: payload
                }]
            });
            alert("Bet Sent! Waiting for block confirmation...");
        } catch (e) {
            alert("Transaction Failed or Cancelled");
        } finally {
            betBtn.innerText = "PLACE BET NOW";
            betBtn.disabled = false;
        }
    }

    async function withdrawRef() {
        if (!tonConnectUI.connected) return alert("Connect wallet!");
        try {
            const cell = new TonWeb.boc.Cell();
            cell.bits.writeUint(0, 32); // Text Comment Prefix
            cell.bits.writeBytes(new TextEncoder().encode("WithdrawRef"));
            const payload = TonWeb.utils.bytesToBase64(await cell.toBoc());

            await tonConnectUI.sendTransaction({
                validUntil: Math.floor(Date.now() / 1000) + 300,
                messages: [{
                    address: CONTRACT_ADDRESS,
                    amount: "50000000", // 0.05 TON Gas
                    payload: payload
                }]
            });
        } catch (e) { alert("Action Cancelled"); }
    }

    function copyRef() {
        const link = document.getElementById('ref-link').innerText;
        navigator.clipboard.writeText(link);
        const btn = document.getElementById('copy-btn');
        btn.innerText = "COPIED âœ…";
        setTimeout(() => btn.innerText = "COPY LINK", 2000);
    }

    tonConnectUI.onStatusChange(wallet => {
        if (wallet) {
            const myAddr = wallet.account.address;
            document.getElementById('ref-link').innerText = window.location.origin + window.location.pathname + "?ref=" + myAddr;
        }
    });

    // Dummy History for UI
    const mock = [
        {p: "EQD...a82", s: "ODD", r: "WIN", c: "var(--green)"},
        {p: "EQB...f10", s: "EVEN", r: "LOSS", c: "#ff4d4d"}
    ];
    document.getElementById('history-body').innerHTML = mock.map(i => `<tr><td>${i.p}</td><td>${i.s}</td><td style="color:${i.c};font-weight:bold">${i.r}</td></tr>`).join('');
</script>
</body>
</html>
