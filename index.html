<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Golden Odd-Even | Premium TON Game</title>
    
    <script src="https://unpkg.com/@tonconnect/ui@latest/dist/tonconnect-ui.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/tonweb/0.0.66/tonweb.js"></script>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    
    <style>
        :root { --gold: #FFD700; --bg: #0f172a; --card: #1e293b; --text: #f8fafc; --accent: #f59e0b; }
        body.light-mode { --bg: #f1f5f9; --card: #ffffff; --text: #0f172a; }
        body { background: var(--bg); color: var(--text); font-family: 'Segoe UI', sans-serif; margin: 0; padding-bottom: 80px; transition: 0.3s; overflow-x: hidden; }
        header { padding: 15px 20px; display: flex; justify-content: space-between; align-items: center; background: var(--card); border-bottom: 2px solid var(--gold); position: sticky; top: 0; z-index: 1000; }
        .container { padding: 20px; max-width: 480px; margin: auto; }
        .glass-card { background: var(--card); border-radius: 24px; padding: 20px; box-shadow: 0 10px 30px rgba(0,0,0,0.4); margin-bottom: 20px; border: 1px solid rgba(255, 215, 0, 0.1); }
        .banner-img { width: 100%; border-radius: 18px; margin-bottom: 15px; border: 1px solid var(--gold); object-fit: cover; height: 180px; }
        .fair-bg { background: linear-gradient(rgba(0,0,0,0.85), rgba(0,0,0,0.85)), url('https://i.postimg.cc/XJfvQK5S/IMG-20260115-210549.png'); background-size: cover; padding: 20px; border-radius: 15px; display: none; margin-top: 10px; border: 1px solid var(--gold); }
        .btn-main { background: linear-gradient(135deg, #f59e0b, #d97706); color: white; border: none; padding: 16px; border-radius: 14px; font-weight: bold; width: 100%; cursor: pointer; font-size: 1.1rem; }
        .selection-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 15px; margin: 20px 0; }
        .select-btn { padding: 18px; border: 2px solid #334155; border-radius: 14px; background: rgba(255,255,255,0.05); color: var(--text); font-weight: 800; cursor: pointer; }
        .select-btn.active { border-color: var(--gold); background: rgba(255, 215, 0, 0.15); color: var(--gold); }
        nav { position: fixed; bottom: 0; width: 100%; background: var(--card); display: flex; justify-content: space-around; padding: 12px 0; border-top: 2px solid var(--gold); }
        .nav-item { text-align: center; font-size: 0.75rem; opacity: 0.5; cursor: pointer; }
        .nav-item.active { opacity: 1; color: var(--gold); }
        .hidden { display: none; }
    </style>
</head>
<body>

    <header>
        <div onclick="toggleTheme()" style="cursor: pointer;"><i class="fas fa-moon" id="theme-icon"></i></div>
        <div id="ton-connect"></div>
    </header>

    <div class="container">
        <div id="lobby-section">
            <div class="glass-card">
                <img src="https://i.postimg.cc/XJfvQK5S/IMG-20260115-210549.png" class="banner-img">
                <h2 style="color: var(--gold);">Golden ODD-EVEN</h2>
                <p>Win 1.90x in seconds on TON Blockchain!</p>
                <button class="btn-main" onclick="showSection('play')">PLAY NOW</button>
                <div style="margin-top: 20px; text-align: center;">
                    <span onclick="toggleFairInfo()" style="cursor: pointer; color: var(--accent);"><i class="fas fa-file-alt"></i> Fair Play Info</span>
                    <div id="fair-modal" class="fair-bg">
                        <h4>Provably Fair</h4>
                        <p style="font-size: 0.8rem; text-align: left;">Powered by TON Smart Contract. Outcomes are generated on-chain using nativePrepareRandom(). 100% transparent.</p>
                    </div>
                </div>
            </div>
        </div>

        <div id="play-section" class="hidden">
            <div class="glass-card">
                <img src="https://i.postimg.cc/8zfNZBQP/IMG-20260115-210803.png" class="banner-img" style="height:120px;">
                <div style="display: flex; justify-content: space-between; font-weight: bold;">
                    <span>Bet: <span id="bet-display" style="color: var(--gold);">0.1</span> TON</span>
                    <span>Win: <span id="win-display" style="color: #22c55e;">0.19</span> TON</span>
                </div>
                <input type="range" min="0.1" max="1.0" step="0.1" value="0.1" style="width:100%; margin:20px 0;" oninput="updateBetUI(this.value)">
                <div class="selection-grid">
                    <button id="btn-even" class="select-btn" onclick="setSide(true)">EVEN</button>
                    <button id="btn-odd" class="select-btn" onclick="setSide(false)">ODD</button>
                </div>
                <button class="btn-main" onclick="handlePlaceBet()">PLACE BET NOW</button>
            </div>
        </div>

        <div id="invite-section" class="hidden">
            <div class="glass-card" style="text-align: center;">
                <i class="fas fa-gift" style="font-size: 2.5rem; color: var(--gold);"></i>
                <h2>Invite & Earn 10%</h2>
                <h1 id="ref-balance-ui" style="color: var(--gold);">0.00 TON</h1>
                <button class="btn-main" onclick="handleWithdrawRef()">WITHDRAW REWARDS</button>
                <div style="margin-top:20px; background:rgba(0,0,0,0.2); padding:10px; border-radius:10px;">
                    <input type="text" id="ref-url" readonly style="width:70%; background:transparent; border:none; color:var(--gold);">
                    <button onclick="copyInviteLink()" id="copy-btn" style="padding:5px; background:var(--gold); border:none; border-radius:5px;">COPY</button>
                </div>
            </div>
        </div>
    </div>

    <nav>
        <div class="nav-item active" id="nav-lobby" onclick="showSection('lobby')"><i class="fas fa-home"></i><br>Lobby</div>
        <div class="nav-item" id="nav-play" onclick="showSection('play')"><i class="fas fa-dice"></i><br>Play</div>
        <div class="nav-item" id="nav-invite" onclick="showSection('invite')"><i class="fas fa-user-plus"></i><br>Invite</div>
    </nav>

    <script>
        const CONTRACT_ADDRESS = "EQDrMfp_8qbmmnp6mNsg-arxKY2oNvvic1kmWovr6_2kFVNK";
        const tonConnectUI = new TON_CONNECT_UI.TonConnectUI({
            manifestUrl: 'https://phyothetnaing985.github.io/ton-odd-even-game-live/tonconnect-manifest.json',
            buttonRootId: 'ton-connect'
        });

        const tonWeb = new TonWeb();
        let currentSide = null; let currentBet = 0.1;

        function updateBetUI(val) {
            currentBet = parseFloat(val);
            document.getElementById('bet-display').innerText = currentBet.toFixed(1);
            document.getElementById('win-display').innerText = (currentBet * 1.9).toFixed(2);
        }

        function setSide(isEven) {
            currentSide = isEven;
            document.getElementById('btn-even').classList.toggle('active', isEven);
            document.getElementById('btn-odd').classList.toggle('active', !isEven);
        }

        function showSection(id) {
            ['lobby', 'play', 'invite'].forEach(sec => {
                document.getElementById(sec + '-section').classList.add('hidden');
                document.getElementById('nav-' + sec).classList.remove('active');
            });
            document.getElementById(id + '-section').classList.remove('hidden');
            document.getElementById('nav-' + id).classList.add('active');
            if (id === 'invite' && tonConnectUI.account) {
                document.getElementById('ref-url').value = window.location.origin + window.location.pathname + "?ref=" + tonConnectUI.account.address;
            }
        }

        function toggleFairInfo() {
            const m = document.getElementById('fair-modal');
            m.style.display = (m.style.display === 'block') ? 'none' : 'block';
        }

        async function handlePlaceBet() {
            if (!tonConnectUI.connected) return alert("Please connect wallet!");
            if (currentSide === null) return alert("Select EVEN or ODD!");
            try {
                const cell = new TonWeb.boc.Cell();
                cell.bits.writeUint(0x65228565, 32); 
                cell.bits.writeBit(currentSide);
                const params = new URLSearchParams(window.location.search);
                const ref = params.get('ref');
                if (ref && TonWeb.Address.isValid(ref)) {
                    cell.bits.writeBit(1); cell.bits.writeAddress(new TonWeb.utils.Address(ref));
                } else { cell.bits.writeBit(0); }

                const tx = {
                    validUntil: Math.floor(Date.now() / 1000) + 300,
                    messages: [{
                        address: CONTRACT_ADDRESS,
                        amount: TonWeb.utils.toNano(currentBet.toString()).toString(),
                        payload: TonWeb.utils.bytesToBase64(await cell.toBoc())
                    }]
                };
                await tonConnectUI.sendTransaction(tx);
            } catch (e) { alert("Error: " + e.message); }
        }

        function copyInviteLink() {
            const input = document.getElementById('ref-url');
            input.select(); document.execCommand('copy');
            document.getElementById('copy-btn').innerText = "COPIED!";
            setTimeout(() => { document.getElementById('copy-btn').innerText = "COPY"; }, 2000);
        }

        function toggleTheme() {
            document.body.classList.toggle('light-mode');
        }
    </script>
</body>
</html>
