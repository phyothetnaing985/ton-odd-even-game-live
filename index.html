<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Golden Odd Even â€” TON</title>
<meta name="viewport" content="width=device-width,initial-scale=1">
<script src="https://unpkg.com/@tonconnect/ui@latest/dist/tonconnect-ui.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/tonweb@0.0.66/dist/tonweb.js"></script>

<style>
:root{
 --bg:#0b0e11;--card:#1c2128;--accent:#f3ba2f;
 --green:#00c087;--text:#eaecef;--nav:#161b22;
}
body{margin:0;background:var(--bg);color:var(--text);font-family:Inter}
.header{display:flex;justify-content:space-between;align-items:center;
 padding:12px;background:var(--nav)}
.screen{display:none;padding:16px}
.active{display:block}
.game-card{background:var(--card);border-radius:18px;padding:20px}
.banner{height:200px;background:url('https://i.postimg.cc/8zfNZBQP/IMG-20260115-210803.png') center/cover}
.btn{padding:16px;border-radius:14px;border:none;font-weight:900}
.green{background:var(--green)}
.accent{background:var(--accent)}
.footer{position:fixed;bottom:0;width:100%;display:flex;background:var(--nav)}
.footer div{flex:1;text-align:center;padding:10px}
</style>
</head>

<body>

<div class="header">
  <div id="ton-connect"></div>
  <div onclick="alert('Provably Fair: random(1..10), 50/50')">ðŸ“œ</div>
</div>

<div id="lobby" class="screen active">
  <div class="banner"></div>
  <div class="game-card">
    <h2>ODD EVEN</h2>
    <button class="btn accent" onclick="show('play')">PLAY</button>
  </div>
</div>

<div id="play" class="screen">
  <div class="game-card">
    <div>
      <button class="btn" onclick="setSide(false)">ODD</button>
      <button class="btn" onclick="setSide(true)">EVEN</button>
    </div>
    <input type="range" min="0.1" max="1" step="0.1" value="0.1" oninput="update(this.value)">
    <div>BET <span id="bet">0.1</span> | WIN <span id="win">0.19</span></div>
    <button class="btn green" onclick="bet()">PLACE BET NOW</button>
  </div>
</div>

<div id="invite" class="screen">
  <div class="game-card">
    <h3>10% Referral</h3>
    <div id="refBal">0 TON</div>
    <button class="btn green" onclick="withdrawRef()">WITHDRAW</button>
    <div id="refLink"></div>
  </div>
</div>

<div class="footer">
  <div onclick="show('lobby')">Lobby</div>
  <div onclick="show('invite')">Invite</div>
</div>

<script>
const CONTRACT = "PUT_DEPLOYED_ADDRESS_HERE";
let side = null;

const tc = new TON_CONNECT_UI.TonConnectUI({
  manifestUrl:"https://phyothetnaing985.github.io/ton-odd-even-game-live/tonconnect-manifest.json",
  buttonRootId:"ton-connect"
});

function show(id){
 document.querySelectorAll('.screen').forEach(s=>s.classList.remove('active'));
 document.getElementById(id).classList.add('active');
}

function setSide(s){side=s}
function update(v){
 bet.innerText=v;
 win.innerText=(v*1.9).toFixed(2);
}

async function bet(){
 if(!tc.connected)return tc.openModal();
 if(side===null)return alert("Choose side");

 const cell=new TonWeb.boc.Cell();
 TonWeb.boc.writeMessage(cell,{
   type:'Bet',
   sideEven:side,
   referrer:new URLSearchParams(location.search).get('ref')
 });

 await tc.sendTransaction({
   validUntil:Date.now()/1000+300,
   messages:[{
     address:CONTRACT,
     amount:TonWeb.utils.toNano(bet.innerText).toString(),
     payload:TonWeb.utils.bytesToBase64(await cell.toBoc())
   }]
 });
}

async function withdrawRef(){
 const cell=new TonWeb.boc.Cell();
 TonWeb.boc.writeMessage(cell,{type:'WithdrawRef'});
 await tc.sendTransaction({
   validUntil:Date.now()/1000+300,
   messages:[{address:CONTRACT,amount:TonWeb.utils.toNano("0.05"),payload:TonWeb.utils.bytesToBase64(await cell.toBoc())}]
 });
}

tc.onStatusChange(w=>{
 if(w){
  const a=new TonWeb.utils.Address(w.account.address).toString(true,true,true);
  refLink.innerText=location.origin+location.pathname+"?ref="+a;
 }
});
</script>
</body>
</html>
